<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
       xmlns:f="http://java.sun.com/jsf/core"
       xmlns:p="http://primefaces.org/ui"
       xmlns:c="http://java.sun.com/jsp/jstl/core"
       xmlns:ui="http://java.sun.com/jsf/facelets"
       xmlns:h="http://java.sun.com/jsf/html">

<h:head>
    <title>Registration Page</title>
</h:head>
<h:body>
    <f:view>
        <h:form id="registerForm">
            <table>
                <tr>
                    <td><h:outputText value="Enter Your Name"/></td>
                    <td><h:inputText value="#{mainController.user.name}"/></td>
                    <td><h:outputText value="Enter Your Login"/></td>
                    <td><h:inputText id="name1" value="#{mainController.user.login}" required="true"
                                     requiredMessage="Name field should be filled"/></td>
                    <td><h:message for="name" style="color:red"/></td>
                </tr>
                <tr>
                    <td><h:outputText value="Enter Password :"/></td>
                    <td><h:inputSecret id="psw" value="#{mainController.user.password}" required="true"
                                       requiredMessage="Password field should be filled"/></td>
                    <td><h:message for="psw" style="color:red"/></td>
                </tr>
                <tr>
                    <td/>
                    <td><h:commandButton value="Register" action="#{usersController.addNewUser}"/></td>
                </tr>
                <tr>
                    <td><h:outputLink value="login.xhtml">Home</h:outputLink></td>
                </tr>
            </table>
        </h:form>


        <h:form rendered="#{!(mainController.loggedIn)}">
            <h:outputLink value="javascript:void(0)" onclick="PF('dlg').show();" title="login">
                <p:graphicImage width="80" height="50" library="Images" name="login.png" />
            </h:outputLink>

            <p:growl id="growl" sticky="true" showDetail="true" life="3000" />

            <p:dialog header="Login" widgetVar="dlg" resizable="false">
                <h:panelGrid columns="2" cellpadding="5">
                    <h:outputLabel for="username" value="Username:" />
                    <p:inputText id="username" value="#{mainController.user.login}" required="true" label="username" />

                    <h:outputLabel for="password" value="Password:" />
                    <p:password id="password_L" value="#{mainController.user.password}" required="true" label="password" />

                    <f:facet name="footer">
                        <p:commandButton value="Login" update="growl" actionListener="#{mainController.login}"
                                         oncomplete="handleLoginRequest(xhr, status, args)" />
                    </f:facet>
                </h:panelGrid>
            </p:dialog>
        </h:form>

        <h:form rendered="#{!(mainController.loggedIn)}">
            <h:outputLink value="javascript:void(1)" onclick="PF('dlg').show();" title="signup">
                <p:graphicImage width="80" height="50" library="Images" name="signUp.png" />
            </h:outputLink>

            <p:growl id="growlR" sticky="true" showDetail="true" life="3000" />

            <p:dialog header="Sign Up" widgetVar="dlg" resizable="false">
                <h:panelGrid columns="2" cellpadding="5">
                    <h:outputLabel for="name" value="Name:" />
                    <p:inputText id="name" value="#{mainController.user.name}" required="true" label="username" />

                    <h:outputLabel for="login" value="Login:" />
                    <p:inputText id="login" value="#{mainController.user.login}" required="true" label="login" />

                    <h:outputLabel for="password" value="Password:" />
                    <p:password id="password" value="#{mainController.user.password}" required="true" label="password" />

                    <f:facet name="footer">
                        <p:commandButton value="Sign Up" update="growlR" action ="#{usersController.registerUser}"
                                         oncomplete="handleSignUpRequest(xhr, status, args)" />
                    </f:facet>
                </h:panelGrid>
            </p:dialog>
        </h:form>

        <script type="text/javascript">
            function handleSignUpRequest(xhr, status, args) {
                PF('dlg').hide();
                $('#signupLink').fadeOut();
            }
        </script>
    </f:view>
</h:body>
</html>